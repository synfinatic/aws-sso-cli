
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Aaron Turner">
      
      
      
        <link rel="prev" href="../release/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.32">
    
    
      
        <title>ECS Server Threat Model - AWS SSO CLI</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/asciinema-player.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ecs-server-threat-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AWS SSO CLI" class="md-header__button md-logo" aria-label="AWS SSO CLI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AWS SSO CLI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ECS Server Threat Model
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/synfinatic/aws-sso-cli/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AWS SSO CLI" class="md-nav__button md-logo" aria-label="AWS SSO CLI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    AWS SSO CLI
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/synfinatic/aws-sso-cli/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../demos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commands & Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FAQ/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frequently Asked Questions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ECS Server/Remote Access
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            ECS Server/Remote Access
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ecs-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECS Server Mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ecs-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECS Server Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remote-ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Access to IAM Roles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ecs-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECS Server API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    About
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws-vault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compared to aws-vault
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reporting Security Vulnerabilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    GPG Signing Keys
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            GPG Signing Keys
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code-sign-key.asc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Signing Key
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commit-sign-key.asc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commit Signing Key
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Developer Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release New Version
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ECS Server Threat Model
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ECS Server Threat Model
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#problem-description" class="md-nav__link">
    <span class="md-ellipsis">
      Problem Description
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      Solution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Attacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attacker-has-root-on-the-box-running-aws-sso-ecs-server" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has root on the box running aws-sso ECS Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-non-root-on-the-box-running-aws-sso-ecs-server" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has non-root on the box running aws-sso ECS Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-root-on-the-box-running-aws-sso-client" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has root on the box running aws-sso client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-non-root-on-the-box-running-the-aws-sso-client" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has non-root on the box running the aws-sso client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-root-on-the-box-running-aws-sdk" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has root on the box running AWS SDK
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-a-non-root-account-on-the-box-running-the-aws-sdk" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has a non-root account on the box running the AWS SDK
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-can-posion-dns-or-etchosts" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker can posion DNS or /etc/hosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-can-dos-the-certificate-signing-service" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker can DoS the certificate signing service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-can-exploit-the-certificate-signing-service" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker can exploit the certificate signing service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      Suggestions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#problem-description" class="md-nav__link">
    <span class="md-ellipsis">
      Problem Description
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      Solution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Attacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attacker-has-root-on-the-box-running-aws-sso-ecs-server" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has root on the box running aws-sso ECS Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-non-root-on-the-box-running-aws-sso-ecs-server" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has non-root on the box running aws-sso ECS Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-root-on-the-box-running-aws-sso-client" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has root on the box running aws-sso client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-non-root-on-the-box-running-the-aws-sso-client" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has non-root on the box running the aws-sso client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-root-on-the-box-running-aws-sdk" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has root on the box running AWS SDK
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-has-a-non-root-account-on-the-box-running-the-aws-sdk" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker has a non-root account on the box running the AWS SDK
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-can-posion-dns-or-etchosts" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker can posion DNS or /etc/hosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-can-dos-the-certificate-signing-service" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker can DoS the certificate signing service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attacker-can-exploit-the-certificate-signing-service" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker can exploit the certificate signing service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      Suggestions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="ecs-server-threat-model">ECS Server Threat Model</h1>
<h2 id="problem-description">Problem Description</h2>
<p>The AWS SDK supports fetching the IAM Credentials used for making calls to the AWS API
the HTTP endpoint defined by the <a href="https://docs.aws.amazon.com/sdkref/latest/guide/feature-container-credentials.html">AWS_CONTAINER_CREDENTIALS_FULL_URI</a>
environment variable.</p>
<p>This connection will expose the AWS API credentials for one or more IAM Roles and should
be secured as much as possible.  Unfortunately, the
<a href="https://github.com/aws/aws-sdk/issues/774">AWS SDK only supports public Certificates of Authority</a> to enable users to run their own local service
which impliments this API on <code>localhost</code>.</p>
<p>But <a href="https://letsencrypt.org/docs/certificates-for-localhost/">public CA's will not create certificates for localhost</a>.</p>
<h2 id="solution">Solution</h2>
<p>In order to support <code>aws-sso</code> users who wish to run their own endpoint for
<code>AWS_CONTAINER_CREDENTIALS_FULL_URI</code>, we need to create a new public web service which:</p>
<hr />
<p>Scenario: A user wishes to create an account</p>
<ul>
<li>Given: A new user who has never enabled SSL before</li>
<li>When: The user chooses a unique username and password</li>
<li>And: Provides a valid email address</li>
<li>Then: The service creates an account for the user</li>
</ul>
<p>Note: I generally need to think about the onboarding workflow so this may change.</p>
<hr />
<p>Scenario: A user wishes to register a FQDN for a SSL certificate</p>
<ul>
<li>Given: A valid user who has logged in</li>
<li>When: The user chooses a <em>unique hostname</em> for <code>aws-sso-cli.org</code></li>
<li>Then: Service creates a DNS A record for <em>hostname.aws-sso-cli.org</em> pointing to <code>127.0.0.1</code></li>
<li>And: The user runs the command locally: <code>aws-sso setup ecs cert fqdn &lt;fqdn&gt;</code></li>
</ul>
<hr />
<p>Scenario: A user wishes to enable CSR signing for the ECS Server certificates</p>
<ul>
<li>Given: A valid user who has logged in</li>
<li>When: The user asks for a new API Key via the web interface</li>
<li>Then: Web service generates a new API key for the user</li>
<li>And: The user runs the command locally <code>aws-sso setup ecs cert api-key &lt;api key&gt;</code></li>
</ul>
<hr />
<p>Scenario: A user wishes to get a signed certificate from the web service</p>
<ul>
<li>Given: A valid API key for a user has been configured</li>
<li>When: The user runs <code>aws-sso setup ecs cert sign-csr</code></li>
<li>Then: A new private key / certificate signing request will be generated locally<ul>
<li>And: The private key will be stored in the SecureStore</li>
<li>And: The CSR will be uploaded to the webservice, using the configured API key for authentication</li>
</ul>
</li>
</ul>
<hr />
<p>Scenario: A user has requested a signed certificate from the web service</p>
<ul>
<li>Given: The user has run <code>aws-sso setup ecs cert sign-csr</code></li>
<li>When: The service validates the API key is assigned to the FQDN in the CSR</li>
<li>Then: The service asks Let's Encrypt to sign the CSR via ACME DNS-01<ul>
<li>And: Let's Encrypt signs the CSR</li>
<li>And: Service returns the signed Certificate to the user.</li>
</ul>
</li>
</ul>
<hr />
<p>Scenario: A user has their own CA they'd like to use to sign the certificate</p>
<ul>
<li>Given: The user does not wish to use the public web service to manage their certificate</li>
<li>When: A user runs <code>aws-sso setup ecs cert export-csr</code></li>
<li>Then: A new private key / certificate signing request will be generated locally<ul>
<li>And: The private key will be stored in the SecureStore</li>
<li>And: The CSR will be written to a file</li>
</ul>
</li>
</ul>
<hr />
<p>Scenario: A user has signed the CSR with their own CA</p>
<ul>
<li>Given: The user has exported a CSR and has had it signed by a CA</li>
<li>When: The user runs <code>aws-sso setup ecs cert load &lt;file&gt;</code></li>
<li>Then: <code>aws-sso</code> will store the certificate for the ECS Server</li>
</ul>
<hr />
<p>Scenario: A user wishes to use ECS Server in SSL mode</p>
<ul>
<li>Given: <code>aws-sso</code> has a valid private key and certificate configured</li>
<li>When: The user runs the command <code>aws-sso ecs docker start</code></li>
<li>Then: The ECS Server runs locally<ul>
<li>And: Uses the configured SSL private key/certificate</li>
<li>And: Uses the configured Bearer Token</li>
</ul>
</li>
</ul>
<hr />
<p>Scenario: A user wishes to use the ECS Server in SSL mode</p>
<ul>
<li>Given: The user is locally running the ECS Server in SSL Mode<ul>
<li>And: The user has configured a Bearer Token for the AWS SDK</li>
<li>And: The user has loaded one or more AWS API credentials via <code>aws-sso ecs load ...</code></li>
</ul>
</li>
<li>When: The user has defined <code>AWS_CREDENTIALS_FULL_URI=https://&lt;fqdn&gt;:4144</code> in the current shell</li>
<li>And: The AWS SDK attempts to connect to the ECS Server via <code>127.0.0.1:4144</code> to retrive the AWS API credentials</li>
<li>Then: The connection to retrieve the AWS API credentials will be e2e encrypted<ul>
<li>And: The AWS SDK will use SSL to verify the identity of the ECS Server</li>
<li>And: The ECS Server will use the Bearer Token to verify the identiy of the AWS SDK</li>
<li>And: The ECS Server will provide the requested API credentials</li>
<li>And: The AWS SDK will use the provided AWS API credentials in its request</li>
</ul>
</li>
</ul>
<hr />
<p>Scenario: A user wishes to use the AWS SDK on a remote host</p>
<ul>
<li>Given: The user is locally running the ECS Server in SSL Mode<ul>
<li>And: The user has configured a Bearer Token for the AWS SDK</li>
<li>And: The user has loaded one or more AWS API credentials via <code>aws-sso ecs load ...</code></li>
</ul>
</li>
<li>When: The user runs <code>ssh -R 4144:localhost:4144 &lt;host&gt;</code></li>
<li>And: The user has defined <code>AWS_CREDENTIALS_FULL_URI=https://&lt;fqdn&gt;:4144</code> in the remote shell</li>
<li>And: The AWS SDK attempts to connect to the ECS Server via <code>127.0.0.1:4144</code> to retrive the AWS API credentials</li>
<li>Then: The connection will be proxied by ssh to the users local system where the ECS Server is running<ul>
<li>And: The AWS SDK will use SSL to verify the identity of the ECS Server</li>
<li>And: The ECS Server will use the Bearer Token to verify the identiy of the AWS SDK</li>
<li>And: The ECS Server will provide the requested API credentials</li>
<li>And: The AWS SDK will use the provided AWS API credentials in its request</li>
</ul>
</li>
</ul>
<hr />
<h2 id="attacks">Attacks</h2>
<h3 id="attacker-has-root-on-the-box-running-aws-sso-ecs-server">Attacker has root on the box running aws-sso ECS Server</h3>
<ul>
<li>Without SSL: Game over.  Can do anything at this point.</li>
<li>With SSL: same.</li>
</ul>
<h3 id="attacker-has-non-root-on-the-box-running-aws-sso-ecs-server">Attacker has non-root on the box running aws-sso ECS Server</h3>
<ul>
<li>Without SSL: If user has sufficient <a href="https://www.man7.org/linux/man-pages/man7/capabilities.7.html">capabilities</a> to inspect
traffic, they can obtain the Bearer Token or AWS API credentials.</li>
<li>With SSL: No attack; traffic is e2e encrypted and authenticated.</li>
</ul>
<h3 id="attacker-has-root-on-the-box-running-aws-sso-client">Attacker has root on the box running aws-sso client</h3>
<ul>
<li>Without SSL: Game over.  Can do anything at this point.</li>
<li>With SSL: same.</li>
</ul>
<h3 id="attacker-has-non-root-on-the-box-running-the-aws-sso-client">Attacker has non-root on the box running the aws-sso client</h3>
<ul>
<li>Without SSL: If user has sufficient <a href="https://www.man7.org/linux/man-pages/man7/capabilities.7.html">capabilities</a> to inspect
traffic, they can obtain the Bearer Token or AWS API credentials.</li>
<li>With SSL: No attack; traffic is e2e encrypted and authenticated.</li>
</ul>
<h3 id="attacker-has-root-on-the-box-running-aws-sdk">Attacker has root on the box running AWS SDK</h3>
<ul>
<li>Without SSL: Game over.  Can do anything at this point.</li>
<li>With SSL: same.</li>
</ul>
<h3 id="attacker-has-a-non-root-account-on-the-box-running-the-aws-sdk">Attacker has a non-root account on the box running the AWS SDK</h3>
<ul>
<li>Without SSL: Attacker can open a listener on the same port the user
    runs the ssh port-forwarding.  If the user then ignores the error when they ssh
    over, the attacker can get access to the Bearer Token used by the AWS SDK and
    use that later on to extract AWS API credentials.</li>
<li>With SSL: No attack; traffic is e2e encrypted and authenticated.</li>
</ul>
<h3 id="attacker-can-posion-dns-or-etchosts">Attacker can posion DNS or /etc/hosts</h3>
<ul>
<li>Without SSL: Attacker can MITM the connection and get access to the Bearer Token
    and AWS API credentials.<ul>
<li>Mitigate: aws-sso can inspect DNS to ensure IP address is correct</li>
</ul>
</li>
<li>With SSL: Just a DoS because AWS SDK validates SSL cert before sending the Bearer Token</li>
</ul>
<h3 id="attacker-can-dos-the-certificate-signing-service">Attacker can DoS the certificate signing service</h3>
<ul>
<li>Attacker can prevent users from getting updated certificates when they expire.<ul>
<li>Mitigations:<ul>
<li>Consider configurable endpoints</li>
<li>Use CloudFlare</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="attacker-can-exploit-the-certificate-signing-service">Attacker can exploit the certificate signing service</h3>
<ul>
<li>Attacker can issue their own certificate for hostname.aws-sso-cli.org</li>
<li>Attacker can update DNS and point hostname.aws-sso-cli.org at a different IP than 127.0.0.1<ul>
<li>Mitigate: aws-sso client can validate DNS record is valid</li>
</ul>
</li>
<li>Attacker can inject bad data and modify the database of users</li>
<li>Attacker can steal API Key of users to sign CSRs<ul>
<li>Mitigate: use public key auth to mitigate</li>
</ul>
</li>
<li>Lookup "click jacking" -- run Burp scanner</li>
</ul>
<h2 id="suggestions">Suggestions</h2>
<ul>
<li>Examine need for certificate revocation for users.</li>
<li>Look into a private/public cert method of API Key for authentication so people can't dump my database
and issue certs for anyone.</li>
<li>Add extensive logging since we're low traffic and anything interesting will show up easily</li>
<li>Use Burp scanner/suite to do a pen test</li>
<li>Examine what free security options CloudFlare &amp; Fly.io? provide</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2021-2024 Aaron Turner
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.471ce7a9.min.js"></script>
      
        <script src="../js/asciinema-player.min.js"></script>
      
    
  </body>
</html>